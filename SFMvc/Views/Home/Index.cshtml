@{
    ViewBag.Title = "Product";
}

@model IndexVM[]


<div class="overall-container">
    
    <div style="position:relative">
    <div id="loginPlaceholder" style="position: absolute; top:10px; left:10px; display:none;"></div>
    </div>

    <div class="search-container">

        <div class="input-group input-group-lg">
            <input type="text" class="form-control" id="searchText" placeholder="Search by Title..." onkeyup="search()">
        </div>


        <button onclick="search()" class="btn btn-outline-light me-2" style="margin-left: 20px;">Search</button>
    </div>
<div id="searchResults" class="my-container">

</div>

<div id="noResultsMessage" style="display: none;">No matching results found.</div>
</div>
<script>
    function search() {
        var searchText = document.getElementById("searchText").value.toLowerCase();
        var searchResultsContainer = document.getElementById("searchResults");
        var noResultsMessage = document.getElementById("noResultsMessage");
        searchResultsContainer.innerHTML = "";
        noResultsMessage.style.display = "none";
        var resultsFound = false;

    @foreach (var item in Model)
    {
        <text>
        GetButtonText(@item.Id);
         if ("@item.Title".toLowerCase().includes(searchText)) {
         resultsFound = true;
         searchResultsContainer.innerHTML +=
             `<div class="my-col">
                <div class="card">
                <div class="center-cropped card-img-top" style="background-image: url('/Images/@item.ImageUrl');"></div>
                <div class="card-body" style="display: flex; flex-direction: column;">
                  <h2 class="card-title">@item.Title</h2>
                  <p class="format">@item.Format</p>
                  <p class="card-text" style="flex-grow: 1;"></p>
                  <div style="display: flex; justify-content: space-between; align-items: center;">
                      <img src="/Images/@item.LogoUrl" style="height:50px;" />
                              <a class="btn btn-primary" onclick="AddToWatchList(@item.Id)"><div id="buttonText_@item.Id"></div></a>
                  </div>
                </div>
             </div>
           </div>
             `;
         }
        
        </text>

    }
        if (!resultsFound) {
            noResultsMessage.style.display = "block";
        }


    }
 

    function AddToWatchList(id) {
            fetch("/AddToWatchList/" + id,
                {
                    method: "GET",
                })
                .then(result => result.text())
                .then(html => {
                    if (html.includes("login")) {
                        console.log(html)
                        const loginSquare = document.getElementById("loginPlaceholder")
                        loginSquare.innerHTML = html
                        loginSquare.style = "display:block"
                    } else {
                        console.log(html)
                        const buttonDiv = document.getElementById("buttonText_" + id)
                        buttonDiv.innerHTML = html
                    }
                })
    }

    function GetButtonText(id) {
        fetch("/GetButtonText/" + id,
            {
                method: "GET",
            })
            .then(result => result.text())
            .then(html => {
                const buttonDiv = document.getElementById("buttonText_" + id)
                buttonDiv.innerHTML = html
            })  
            
    }

    function removeWindow() {
        const windowtoclose = document.getElementById("loginPlaceholder")
        windowtoclose.style="display:none"
    }

    search();

   
</script>